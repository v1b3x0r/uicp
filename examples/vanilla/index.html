<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üß™ UIP Drawer Demo</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, sans-serif;
      margin: 0;
      padding: 20px;
      background: #f5f5f5;
    }
    
    .demo-section {
      background: white;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    button {
      background: #007AFF;
      color: white;
      border: none;
      padding: 12px 20px;
      border-radius: 6px;
      cursor: pointer;
      margin: 5px;
    }
    
    button:hover { background: #0056CC; }
    
    /* Apple-style drawer */
    .drawer {
      position: fixed;
      left: 0;
      right: 0;
      bottom: 0;
      height: 400px;
      background: rgba(255, 255, 255, 0.98);
      backdrop-filter: blur(20px);
      border-radius: 16px 16px 0 0;
      transform: translateY(100%);
      transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      z-index: 1000;
      box-shadow: 0 -4px 20px rgba(0,0,0,0.1);
    }
    
    .drawer.drawer-open {
      transform: translateY(0) !important;
    }
    
    .backdrop {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.4);
      backdrop-filter: blur(4px);
      z-index: 999;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
    }
    
    .backdrop.show {
      opacity: 1;
      visibility: visible;
    }
    
    .drawer-content {
      padding: 20px;
      height: 100%;
      overflow-y: auto;
    }
    
    .drawer-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid #eee;
    }
    
    .drawer-handle {
      width: 40px;
      height: 4px;
      background: #ccc;
      border-radius: 2px;
      margin: 10px auto;
    }
    
    #logs {
      background: #1d1d1f;
      color: #00FF41;
      font-family: monospace;
      font-size: 12px;
      padding: 10px;
      border-radius: 4px;
      max-height: 200px;
      overflow-y: auto;
      margin: 10px 0;
    }
    
    .status {
      display: inline-block;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 12px;
    }
    
    .pass { background: #E8F5E8; color: #2D6A2D; }
    .fail { background: #FFF2F2; color: #A83333; }
    .info { background: #F0F8FF; color: #0066CC; }
    
    /* Test Results */
    .test-summary { padding: 10px; border-radius: 4px; margin: 10px 0; font-weight: bold; }
    .test-summary.pass { background: #E8F5E8; color: #2D6A2D; }
    .test-summary.fail { background: #FFF2F2; color: #A83333; }
    
    .test-result { display: flex; justify-content: space-between; padding: 5px 10px; border-bottom: 1px solid #eee; }
    .test-result.pass { background: #f9fff9; }
    .test-result.fail { background: #fff9f9; }
    .test-error { font-size: 11px; color: #666; margin-top: 5px; }
  </style>
</head>
<body>
  <h1>üß™ UIP Drawer Demo</h1>
  <p>World-class single-file drawer implementation</p>
  
  <!-- Main Demo -->
  <div class="demo-section">
    <h2>üì± Drawer Test</h2>
    <div>
      <button id="vanilla-drawer-trigger">Open Drawer</button>
      <button id="debug-state">Debug State</button>
      <button id="clear-logs">Clear Logs</button>
    </div>
    <div id="status">
      Status: <span id="drawer-status" class="status pass">Ready</span>
    </div>
  </div>
  
  <!-- Debug Controls -->
  <div class="demo-section">
    <h3>üõ† Debug Controls</h3>
    <div>
      <button id="force-open">Force Open (CSS)</button>
      <button id="force-close">Force Close (CSS)</button>
    </div>
  </div>
  
  <!-- Logs -->
  <div class="demo-section">
    <h3>üìú Event Logs</h3>
    <div id="logs">‚úÖ World-class drawer initialized</div>
  </div>
  
  <!-- Test Results -->
  <div class="demo-section">
    <h3>üß™ Automated Tests</h3>
    <div>
      <button onclick="window.testRunner?.runTests()">Run Tests</button>
    </div>
    <div id="test-results" style="margin-top: 15px;">
      Tests will run automatically...
    </div>
  </div>
  
  <!-- Backdrop -->
  <div id="drawer-backdrop" class="backdrop"></div>
  
  <!-- Drawer -->
  <div id="test-drawer" class="drawer">
    <div class="drawer-handle"></div>
    <div class="drawer-content">
      <div class="drawer-header">
        <h3>üçé World-Class Drawer</h3>
        <button id="close-drawer">Close</button>
      </div>
      <div>
        <p>This is a world-class drawer with:</p>
        <ul>
          <li>‚úÖ Single-file implementation</li>
          <li>‚úÖ Framework7-style state management</li>
          <li>‚úÖ Perfect DOM synchronization</li>
          <li>‚úÖ Zero technical debt</li>
          <li>‚úÖ Shadcn-level DX</li>
        </ul>
        <p>Clean, reliable, production-ready!</p>
      </div>
    </div>
  </div>
  
  <script>
    /**
     * World-Class Single-File Drawer Implementation
     * Framework7-inspired, zero dependencies, perfect reliability
     */
    
    // Simple, reliable state management
    class WorldClassDrawer {
      constructor(element, backdrop) {
        this.el = element;
        this.backdrop = backdrop;
        this.opened = false;
      }
      
      open() {
        this.el.classList.add('drawer-open');
        this.backdrop.classList.add('show');
        this.opened = true;
        this.log('üö™ Drawer opened');
      }
      
      close() {
        this.el.classList.remove('drawer-open');
        this.backdrop.classList.remove('show');
        this.opened = false;
        this.log('üö™ Drawer closed');
      }
      
      toggle() {
        this.opened ? this.close() : this.open();
      }
      
      log(message) {
        const logs = document.getElementById('logs');
        if (logs) {
          logs.textContent += '\n' + message;
          logs.scrollTop = logs.scrollHeight;
        }
        console.log(message);
      }
    }
    
    // Initialize world-class drawer
    const drawerElement = document.getElementById('test-drawer');
    const backdropElement = document.getElementById('drawer-backdrop');
    const drawer = new WorldClassDrawer(drawerElement, backdropElement);
    
    // Event listeners - direct, reliable
    document.getElementById('vanilla-drawer-trigger').addEventListener('click', () => drawer.open());
    document.getElementById('close-drawer').addEventListener('click', () => drawer.close());
    document.getElementById('drawer-backdrop').addEventListener('click', () => drawer.close());
    document.getElementById('force-open').addEventListener('click', () => drawer.open());
    document.getElementById('force-close').addEventListener('click', () => drawer.close());
    
    // Debug controls
    document.getElementById('debug-state').addEventListener('click', () => {
      const state = {
        opened: drawer.opened,
        hasClass: drawerElement.classList.contains('drawer-open'),
        transform: getComputedStyle(drawerElement).transform,
        backdropShow: backdropElement.classList.contains('show')
      };
      drawer.log(`State: ${JSON.stringify(state, null, 2)}`);
    });
    
    document.getElementById('clear-logs').addEventListener('click', () => {
      document.getElementById('logs').textContent = '‚úÖ World-class drawer initialized';
    });
    
    // Export API for tests
    window.demoAPI = {
      drawer: () => drawer,
      log: (message) => drawer.log(`[Demo] ${message}`)
    };
    
    /**
     * Embedded Test Runner - World Class Quality
     */
    const tests = [];
    let testResults = [];
    
    function test(name, testFn) {
      tests.push({ name, testFn });
    }
    
    async function runTests() {
      console.log('üß™ Starting world-class test suite...');
      testResults = [];
      
      for (const { name, testFn } of tests) {
        try {
          console.log(`Running: ${name}`);
          await testFn();
          testResults.push({ name, status: 'PASS', error: null });
          console.log(`‚úÖ PASS: ${name}`);
        } catch (error) {
          testResults.push({ name, status: 'FAIL', error: error.message });
          console.error(`‚ùå FAIL: ${name} - ${error.message}`);
        }
      }
      
      const passed = testResults.filter(r => r.status === 'PASS').length;
      const failed = testResults.filter(r => r.status === 'FAIL').length;
      
      console.log(`\\nüìä Test Results: ${passed} passed, ${failed} failed`);
      updateTestUI();
      
      return { passed, failed, results: testResults };
    }
    
    function updateTestUI() {
      const container = document.getElementById('test-results');
      if (!container) return;
      
      const passed = testResults.filter(r => r.status === 'PASS').length;
      const failed = testResults.filter(r => r.status === 'FAIL').length;
      
      container.innerHTML = `
        <h4>Test Results (${passed + failed} tests)</h4>
        <div class="test-summary ${failed > 0 ? 'fail' : 'pass'}">
          ‚úÖ ${passed} passed | ‚ùå ${failed} failed
        </div>
        <div class="test-details">
          ${testResults.map(result => `
            <div class="test-result ${result.status.toLowerCase()}">
              <span class="test-name">${result.name}</span>
              <span class="test-status">${result.status}</span>
              ${result.error ? `<div class="test-error">${result.error}</div>` : ''}
            </div>
          `).join('')}
        </div>
      `;
    }
    
    // Helper functions
    function waitFor(ms) {
      return new Promise(resolve => setTimeout(resolve, ms));
    }
    
    function expectElement(selector) {
      const element = document.querySelector(selector);
      if (!element) {
        throw new Error(`Element not found: ${selector}`);
      }
      
      return {
        toExist: () => element,
        toHaveClass: (className) => {
          if (!element.classList.contains(className)) {
            throw new Error(`Element ${selector} does not have class: ${className}`);
          }
        },
        toNotHaveClass: (className) => {
          if (element.classList.contains(className)) {
            throw new Error(`Element ${selector} has class: ${className}`);
          }
        },
        toHaveText: (text) => {
          if (!element.textContent.includes(text)) {
            throw new Error(`Element ${selector} does not contain text: ${text}`);
          }
        }
      };
    }
    
    function clickElement(selector) {
      const element = document.querySelector(selector);
      if (!element) {
        throw new Error(`Element not found: ${selector}`);
      }
      element.click();
    }
    
    // Define world-class tests
    test('Demo API should initialize', async () => {
      if (!window.demoAPI) {
        throw new Error('demoAPI not found');
      }
      
      if (!window.demoAPI.drawer()) {
        throw new Error('Drawer instance not found');
      }
    });
    
    test('Drawer should exist in DOM', async () => {
      expectElement('#test-drawer').toExist();
      expectElement('#vanilla-drawer-trigger').toExist();
      expectElement('#drawer-backdrop').toExist();
    });
    
    test('Drawer should open on button click', async () => {
      // Initial state - should be closed
      expectElement('#test-drawer').toNotHaveClass('drawer-open');
      
      // Click trigger
      clickElement('#vanilla-drawer-trigger');
      
      // Wait for state update (immediate)
      await waitFor(50);
      
      // Check it opened
      expectElement('#test-drawer').toHaveClass('drawer-open');
      expectElement('#drawer-backdrop').toHaveClass('show');
    });
    
    test('Drawer should close with close button', async () => {
      // Ensure drawer is open first
      clickElement('#vanilla-drawer-trigger');
      await waitFor(50);
      expectElement('#test-drawer').toHaveClass('drawer-open');
      
      // Click close button
      clickElement('#close-drawer');
      await waitFor(50);
      
      // Should be closed
      expectElement('#test-drawer').toNotHaveClass('drawer-open');
      expectElement('#drawer-backdrop').toNotHaveClass('show');
    });
    
    test('Drawer should close with backdrop click', async () => {
      // Open drawer
      clickElement('#vanilla-drawer-trigger');
      await waitFor(50);
      expectElement('#test-drawer').toHaveClass('drawer-open');
      
      // Click backdrop
      clickElement('#drawer-backdrop');
      await waitFor(50);
      
      // Should be closed
      expectElement('#test-drawer').toNotHaveClass('drawer-open');
    });
    
    test('Force open should work', async () => {
      // Ensure closed first
      expectElement('#test-drawer').toNotHaveClass('drawer-open');
      
      // Force open
      clickElement('#force-open');
      await waitFor(50);
      
      // Should be open
      expectElement('#test-drawer').toHaveClass('drawer-open');
      expectElement('#drawer-backdrop').toHaveClass('show');
    });
    
    test('Force close should work', async () => {
      // Force open first
      clickElement('#force-open');
      await waitFor(50);
      expectElement('#test-drawer').toHaveClass('drawer-open');
      
      // Force close
      clickElement('#force-close');
      await waitFor(50);
      
      // Should be closed
      expectElement('#test-drawer').toNotHaveClass('drawer-open');
    });
    
    test('Debug state should show logs', async () => {
      // Clear logs
      clickElement('#clear-logs');
      await waitFor(50);
      
      // Debug state
      clickElement('#debug-state');
      await waitFor(50);
      
      // Check logs updated
      expectElement('#logs').toHaveText('State:');
    });
    
    test('Multiple open/close cycles should work', async () => {
      for (let i = 0; i < 3; i++) {
        // Open
        clickElement('#vanilla-drawer-trigger');
        await waitFor(50);
        expectElement('#test-drawer').toHaveClass('drawer-open');
        
        // Close
        clickElement('#close-drawer');
        await waitFor(50);
        expectElement('#test-drawer').toNotHaveClass('drawer-open');
      }
    });
    
    // Export test runner
    window.testRunner = {
      runTests,
      tests,
      results: () => testResults
    };
    
    // Auto-run tests when page loads
    window.addEventListener('load', () => {
      setTimeout(() => {
        if (window.demoAPI) {
          runTests();
        } else {
          console.error('Demo API not found - tests cannot run');
        }
      }, 500);
    });
    
    console.log('‚úÖ World-class drawer initialized');
  </script>
</body>
</html>